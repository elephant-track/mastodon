layout (location = 0) in vec3 aPos;

layout (location = 1) in vec3 t;
layout (location = 2) in vec3 color;

out vec3 Normal;
out vec3 FragPos;
out vec3 ObjectColor;
out float fr;
// fr: radius in screen pixels. this is used to
//     determine at which angle to highlight normals

uniform mat4 pvm;
uniform mat4 vm;
uniform mat3 itvm;
uniform float radius;
uniform float highlight_f;
uniform float highlight_k;

void main()
{
	ObjectColor = color;
	float r = radius;

	vec4 p = vm * vec4(r * aPos + t, 1.0);
	float dilate = highlight_f * p.z + highlight_k;
	// dilate: size of a screen pixel at depth of p,
	//         transformed back to world coordinates
	r += 2 * dilate + 0.1;
	fr = r / dilate;

	vec4 pos = vec4(r * aPos + t, 1.0);
	gl_Position = pvm * pos;
	Normal = normalize(itvm * aPos);
	FragPos = vec3(vm * pos);
}
